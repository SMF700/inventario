<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Inventário de TI - União Supermercados Ltda</title>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.29/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root { --verde:#28a745; --cinza:#f4f6f8; }
    body { font-family: Arial, Helvetica, sans-serif; background:var(--cinza); margin:0; padding:20px; }
    h1,h2,h3 { color:var(--verde); }
    .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); max-width:1300px; margin:auto; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input,select { width:100%; padding:8px; margin-top:4px; }
    button { margin-top:15px; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; background:var(--verde); color:#fff; font-weight:bold; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #ccc; padding:6px; text-align:left; font-size:13px; }
    th { background:var(--verde); color:#fff; }
    #dadosTecnicos { display:none; border-top:1px solid #ddd; margin-top:15px; padding-top:15px; }
    .erro { color:#dc3545; font-weight:bold; margin-top:10px; }
    .info { color:#0d6efd; font-weight:bold; margin-top:10px; }
  </style>
</head>
<body>

<div id="loginBox" class="container" style="max-width:400px;">
  <h2>Acesso ao Inventário</h2>
  <label>Usuário</label>
  <input type="text" id="loginUser">
  <label>Senha</label>
  <input type="password" id="loginPass">
  <button id="btnLogin">Entrar</button>
</div>

<div id="app" style="display:none;">
  <div class="container">
    <h1>Inventário de Equipamentos de TI</h1>
    <h2>União Supermercados Ltda</h2>

    <form id="formInventario">
      <label>Patrimônio</label>
      <input type="text" id="patrimonio" required>

      <label>Tipo de Equipamento</label>
      <select id="tipo" required>
        <option value="">Selecione</option>
        <option value="Computador">Computador</option>
        <option value="PDV">PDV</option>
        <option value="Impressora">Impressora</option>
        <option value="Balança">Balança</option>
        <option value="Servidor">Servidor</option>
        <option value="Outro">Outro</option>
      </select>

      <label>Modelo</label>
      <input type="text" id="modelo">

      <label>Número de Série</label>
      <input type="text" id="serial">

      <label>Local / Loja</label>
      <input type="text" id="local" required>

      <label>Status</label>
      <select id="status">
        <option value="Em uso">Em uso</option>
        <option value="Estoque">Estoque</option>
        <option value="Manutenção">Manutenção</option>
        <option value="Baixado">Baixado</option>
      </select>

      <div id="dadosTecnicos">
        <h3>Dados Técnicos (PDV / Computador)</h3>

        <label>Processador</label>
        <input type="text" id="processador">

        <label>Memória (RAM)</label>
        <select id="memoria">
          <option value="">Selecione</option>
          <option value="2 GB">2 GB</option>
          <option value="4 GB">4 GB</option>
          <option value="8 GB">8 GB</option>
          <option value="16 GB">16 GB</option>
        </select>

        <label>Sistema Operacional</label>
        <select id="so">
          <option value="">Selecione</option>
          <option value="Windows 10">Windows 10</option>
          <option value="Windows 11">Windows 11</option>
          <option value="Linux">Linux</option>
          <option value="Outro">Outro</option>
        </select>

        <label>Arquitetura</label>
        <select id="arquitetura">
          <option value="">Selecione</option>
          <option value="64 bits">64 bits</option>
          <option value="32 bits">32 bits</option>
        </select>

        <label>Tipo de Disco</label>
        <select id="disco">
          <option value="">Selecione</option>
          <option value="HD">HD</option>
          <option value="SSD">SSD</option>
          <option value="NVMe">NVMe</option>
        </select>

        <label>Hostname / IP</label>
        <input type="text" id="hostname">
      </div>

      <button type="submit">Salvar Equipamento</button>
      <div id="erro" class="erro"></div>
      <div id="info" class="info"></div>
    </form>

    <div class="acoes">
      <button id="btnXls">Exportar XLS</button>
      <button id="btnPdf">Exportar PDF</button>
    </div>

    <table id="tabela">
      <thead>
        <tr>
          <th>Patrimônio</th>
          <th>Tipo</th>
          <th>Modelo</th>
          <th>Série</th>
          <th>Local</th>
          <th>Status</th>
          <th>Processador</th>
          <th>Memória</th>
          <th>SO</th>
          <th>Arquitetura</th>
          <th>Disco</th>
          <th>Hostname/IP</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
'use strict';

const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbwizAPmPnXprPfl04sgdcz007dY6AlLBZu1CwLekgo5qcd0UNkpCVKvlQGFYhYHraKk8g/exec';

const loginBox = document.getElementById('loginBox');
const app = document.getElementById('app');
const btnLogin = document.getElementById('btnLogin');
const form = document.getElementById('formInventario');
const tabelaBody = document.querySelector('#tabela tbody');
const tipoSelect = document.getElementById('tipo');
const dadosTecnicos = document.getElementById('dadosTecnicos');
const erroDiv = document.getElementById('erro');
const infoDiv = document.getElementById('info');

btnLogin.addEventListener('click', () => {
  const u = document.getElementById('loginUser').value;
  const p = document.getElementById('loginPass').value;

  if (u === 'ti' && p === 'uniao123') {
    loginBox.style.display = 'none';
    app.style.display = 'block';
    carregarDados();
  } else {
    alert('Usuário ou senha inválidos');
  }
});

tipoSelect.addEventListener('change', () => {
  dadosTecnicos.style.display = ['Computador', 'PDV'].includes(tipoSelect.value) ? 'block' : 'none';
});

function carregarDados() {
  tabelaBody.innerHTML = '';
  const dados = JSON.parse(localStorage.getItem('inventario_ti') || '[]');
  dados.forEach(addLinhaTabela);
  infoDiv.textContent = 'Dados carregados do armazenamento local. Envio ao Google Sheets ativo.';
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const item = {
    patrimonio: patrimonio.value,
    tipo: tipo.value,
    modelo: modelo.value,
    serial: serial.value,
    local: local.value,
    status: status.value,
    processador: processador.value,
    memoria: memoria.value,
    so: so.value,
    arquitetura: arquitetura.value,
    disco: disco.value,
    hostname: hostname.value,
    dataCadastro: new Date().toISOString()
  };

  const dados = JSON.parse(localStorage.getItem('inventario_ti') || '[]');
  dados.push(item);
  localStorage.setItem('inventario_ti', JSON.stringify(dados));
  addLinhaTabela(item);

  try {
    await fetch(SHEETS_API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(item)
    });
    infoDiv.textContent = 'Registro salvo localmente e enviado ao Google Sheets.';
  } catch (err) {
    erroDiv.textContent = 'Erro ao enviar ao Google Sheets (salvo localmente).';
  }

  form.reset();
  dadosTecnicos.style.display = 'none';
});

function addLinhaTabela(item) {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${item.patrimonio}</td>
    <td>${item.tipo}</td>
    <td>${item.modelo}</td>
    <td>${item.serial}</td>
    <td>${item.local}</td>
    <td>${item.status}</td>
    <td>${item.processador || ''}</td>
    <td>${item.memoria || ''}</td>
    <td>${item.so || ''}</td>
    <td>${item.arquitetura || ''}</td>
    <td>${item.disco || ''}</td>
    <td>${item.hostname || ''}</td>`;
  tabelaBody.appendChild(tr);
}

document.getElementById('btnXls').addEventListener('click', () => {
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.table_to_sheet(document.getElementById('tabela'));
  XLSX.utils.book_append_sheet(wb, ws, 'Inventario');
  XLSX.writeFile(wb, 'inventario_ti.xlsx');
});

document.getElementById('btnPdf').addEventListener('click', () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l');
  doc.text('Inventário de TI - União Supermercados Ltda', 14, 10);
  doc.autoTable({ html: '#tabela', startY: 15 });
  doc.save('inventario_ti.pdf');
});
</script>

</body>
</html>
