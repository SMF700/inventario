<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Inventário de TI - Fonseca Supermercados Ltda</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.29/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root { --verde:#28a745; --cinza:#f4f6f8; }
    body { font-family: Arial, Helvetica, sans-serif; background:var(--cinza); margin:0; padding:20px; }
    h1,h2,h3 { color:var(--verde); }
    .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); max-width:1300px; margin:auto; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input,select { width:100%; padding:8px; margin-top:4px; }
    button { margin-top:15px; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; background:var(--verde); color:#fff; font-weight:bold; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th,td { border:1px solid #ccc; padding:6px; text-align:left; font-size:13px; }
    th { background:var(--verde); color:#fff; }
    .acoes button { margin-right:5px; }
    #dadosTecnicos { display:none; border-top:1px solid #ddd; margin-top:15px; padding-top:15px; }
    .erro { color:#dc3545; font-weight:bold; margin-top:10px; }
    .info { color:#0d6efd; font-weight:bold; margin-top:10px; }
  </style>
</head>
<body>

<div id="loginBox" class="container" style="max-width:400px;">
  <h2>Acesso ao Inventário</h2>
  <label>Usuário</label>
  <input type="text" id="loginUser">
  <label>Senha</label>
  <input type="password" id="loginPass">
  <button onclick="login()">Entrar</button>
</div>

<div id="app" style="display:none;">
<div class="container">
  <h1>Inventário de Equipamentos de TI</h1>
  <h2>Fonseca Supermercados Ltda</h2>

  <form id="formInventario">
    <label>Patrimônio</label>
    <input type="text" id="patrimonio" required>

    <label>Tipo de Equipamento</label>
    <select id="tipo" required>
      <option value="">Selecione</option>
      <option value="Computador">Computador</option>
      <option value="PDV">PDV</option>
      <option value="Impressora">Impressora</option>
      <option value="Balança">Balança</option>
      <option value="Servidor">Servidor</option>
      <option value="Outro">Outro</option>
    </select>

    <label>Modelo</label>
    <input type="text" id="modelo">

    <label>Número de Série</label>
    <input type="text" id="serial">

    <label>Local / Loja</label>
    <input type="text" id="local" required>

    <label>Status</label>
    <select id="status">
      <option value="Em uso">Em uso</option>
      <option value="Estoque">Estoque</option>
      <option value="Manutenção">Manutenção</option>
      <option value="Baixado">Baixado</option>
    </select>

    <div id="dadosTecnicos">
      <h3>Dados Técnicos (PDV / Computador)</h3>
      <label>Processador</label>
      <input type="text" id="processador">

      <label>Memória (RAM)</label>
      <select id="memoria">
        <option value="">Selecione</option>
        <option value="2 GB">2 GB</option>
        <option value="4 GB">4 GB</option>
        <option value="8 GB">8 GB</option>
        <option value="16 GB">16 GB</option>
      </select>

      <label>Sistema Operacional</label>
      <select id="so">
        <option value="">Selecione</option>
        <option value="Windows 10">Windows 10</option>
        <option value="Windows 11">Windows 11</option>
        <option value="Linux">Linux</option>
        <option value="Outro">Outro</option>
      </select>

      <label>Arquitetura</label>
      <select id="arquitetura">
        <option value="">Selecione</option>
        <option value="64 bits">64 bits</option>
        <option value="32 bits">32 bits</option>
      </select>

      <label>Tipo de Disco</label>
      <select id="disco">
        <option value="">Selecione</option>
        <option value="HD">HD</option>
        <option value="SSD">SSD</option>
        <option value="NVMe">NVMe</option>
      </select>

      <label>Hostname / IP</label>
      <input type="text" id="hostname">
    </div>

    <button type="submit">Salvar Equipamento</button>
    <div id="erro" class="erro"></div>
    <div id="info" class="info"></div>
  </form>

  <div class="acoes">
    <button onclick="exportarXLS()">Exportar XLS</button>
    <button onclick="exportarPDF()">Exportar PDF</button>
  </div>

  <table id="tabela">
    <thead>
      <tr>
        <th>Patrimônio</th><th>Tipo</th><th>Modelo</th><th>Série</th><th>Local</th><th>Status</th><th>Processador</th><th>Memória</th><th>SO</th><th>Arquitetura</th><th>Disco</th><th>Hostname/IP</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>

<script>
function login(){
  const u = document.getElementById('loginUser').value;
  const p = document.getElementById('loginPass').value;
  if(u === 'ti' && p === 'fonseca123'){
    document.getElementById('loginBox').style.display='none';
    document.getElementById('app').style.display='block';
    carregarDados();
  } else {
    alert('Usuário ou senha inválidos');
  }
}

// IMPORTANTE: o Apps Script DEVE estar publicado como Web App
// Execução: "Qualquer pessoa" | Acesso: "Qualquer pessoa"
const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbwizAPmPnXprPfl04sgdcz007dY6AlLBZu1CwLekgo5qcd0UNkpCVKvlQGFYhYHraKk8g/exec';

const form = document.getElementById('formInventario');
const tabelaBody = document.querySelector('#tabela tbody');
const tipoSelect = document.getElementById('tipo');
const dadosTecnicos = document.getElementById('dadosTecnicos');
const erroDiv = document.getElementById('erro');
const infoDiv = document.getElementById('info');

tipoSelect.addEventListener('change', () => {
  dadosTecnicos.style.display = ['Computador','PDV'].includes(tipoSelect.value) ? 'block' : 'none';
});

async function carregarDados() {
  tabelaBody.innerHTML = '';
  erroDiv.textContent = '';
  infoDiv.textContent = 'Conectando ao Google Sheets...';

  try {
    const res = await fetch(SHEETS_API_URL, { method:'GET' });

    if (!res.ok) throw new Error('Falha HTTP: ' + res.status);

    const dados = await res.json();
    if (!Array.isArray(dados)) throw new Error('Resposta inválida do Sheets');

    infoDiv.textContent = `Registros carregados: ${dados.length}`;

    dados.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.patrimonio || ''}</td>
        <td>${item.tipo || ''}</td>
        <td>${item.modelo || ''}</td>
        <td>${item.serial || ''}</td>
        <td>${item.local || ''}</td>
        <td>${item.status || 'Em uso'}</td>
        <td>${item.processador || ''}</td>
        <td>${item.memoria || ''}</td>
        <td>${item.so || ''}</td>
        <td>${item.arquitetura || ''}</td>
        <td>${item.disco || ''}</td>
        <td>${item.hostname || ''}</td>`;
      tabelaBody.appendChild(tr);
    });
  } catch (e) {
    erroDiv.textContent = 'Erro de conexão com o Google Sheets.';
    infoDiv.textContent = '';
    console.error(e);
  }
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  erroDiv.textContent = '';
  infoDiv.textContent = 'Salvando no Google Sheets...';

  const item = {
    patrimonio: patrimonio.value,
    tipo: tipo.value,
    modelo: modelo.value,
    serial: serial.value,
    local: local.value.trim().toUpperCase(),
    status: status.value || 'Em uso',
    processador: processador.value,
    memoria: memoria.value,
    so: so.value,
    arquitetura: arquitetura.value,
    disco: disco.value,
    hostname: hostname.value,
    dataCadastro: new Date().toISOString()
  };

  try {
    const res = await fetch(SHEETS_API_URL, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify(item)
    });

    if (!res.ok) throw new Error('Falha HTTP: ' + res.status);

    await res.json();
    infoDiv.textContent = 'Registro salvo com sucesso';
    form.reset();
    dadosTecnicos.style.display='none';
    carregarDados();
  } catch (e) {
    erroDiv.textContent = 'Erro ao salvar no Google Sheets.';
    infoDiv.textContent = '';
    console.error(e);
  }
});

function exportarXLS() {
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.table_to_sheet(document.getElementById('tabela'));
  XLSX.utils.book_append_sheet(wb, ws, 'Inventario');
  XLSX.writeFile(wb, 'inventario_ti.xlsx');
}

function exportarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l');
  doc.text('Inventário de TI - Fonseca Supermercados Ltda', 14, 10);
  doc.autoTable({ html: '#tabela', startY: 15 });
  doc.save('inventario_ti.pdf');
}
</script>
</body>
</html>
